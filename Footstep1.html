<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Footstep 1: Let's Go!</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F9FF; /* Light blue background */
            color: #1E3A8A; /* Dark blue text */
        }
        
        /* Main container for the adventure cards */
        .adventure-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1rem;
        }

        /* Styling for each 'adventure card' */
        .adventure-card {
            background-color: #FFFFFF;
            border-radius: 24px; /* More rounded corners */
            padding: 2.5rem; /* More padding */
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 4px solid #BFDBFE; /* Light blue border */
            position: relative; /* For positioning the play button */
        }
        
        /* Header styles */
        .adventure-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .adventure-header h1 {
            font-size: 3rem; /* Larger title */
            font-weight: 700;
            color: #1D4ED8; /* Stronger blue */
            text-shadow: 2px 2px #DBEAFE;
        }

        .adventure-header p {
            font-size: 1.25rem;
            color: #1E4ED8;
        }

        /* Styling for list items in the activity card */
        .activity-li {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: #EFF6FF; /* Very light blue */
            border-radius: 16px;
            transition: all 0.2s ease-in-out;
        }
        .activity-li:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .activity-li-content {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Language switcher styles */
        #lang-switcher-container {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 10;
        }
        
        #lang-switcher {
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 2px solid #BFDBFE;
            background-color: #FFFFFF;
            color: #1E4ED8;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Text-to-speech play button styles */
        .tts-button {
            position: absolute;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            background-color: #2563EB; /* Bright blue */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 3px solid #FFFFFF;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease-in-out;
        }
        .tts-button:hover {
            background-color: #1D4ED8; /* Darker blue */
            transform: scale(1.05);
        }
        .tts-button:active {
            transform: scale(0.95);
        }
        .tts-icon {
            width: 24px;
            height: 24px;
            fill: #FFFFFF; /* White icon */
        }

        /* Speech-to-Text (Microphone) button styles */
        .stt-button {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background-color: #3B82F6; /* Blue */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 2px solid #FFFFFF;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease-in-out;
        }
        .stt-button:hover {
            background-color: #2563EB;
        }
        .stt-button.is-listening {
            background-color: #EF4444; /* Red when listening */
            animation: pulse 1.5s infinite;
        }
        .stt-icon {
            width: 20px;
            height: 20px;
            fill: #FFFFFF;
        }

        /* Pulse animation for listening */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Container for the textarea to position the mic button */
        .textarea-container {
            position: relative;
        }

        /* Make textarea not overlap with mic button */
        #introduction {
            padding-right: 60px; /* Space for the mic button */
        }
    </style>
</head>
<body class="bg-blue-50">

    <!-- Language Switcher -->
    <div id="lang-switcher-container">
        <select id="lang-switcher" onchange="changeLanguage(this.value)">
            <option value="en">English (English)</option>
            <option value="fr">Français (French)</option>
            <option value="ko">한국어 (Korean)</option>
            <option value="ja">日本語 (Japanese)</option>
        </select>
    </div>

    <!-- Main Content Container -->
    <div class="adventure-container">

        <!-- Header Card -->
        <header class="adventure-header adventure-card bg-white" style="background-color: #E0F2FE; border-color: #BAE6FD;">
            <h1 data-key="title" class="text-4xl md:text-5xl font-bold text-blue-800 mb-4">Footstep 1: Let's Go!</h1>
            <p data-key="subtitle" class="text-xl text-blue-700">Let's start our learning adventure together!</p>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </header>

        <!-- What is Footstep 1? Card -->
        <section class="adventure-card" style="background-color: #F0FDF4; border-color: #BBF7D0;">
            <h2 class="text-3xl font-bold text-green-800 mb-4" data-key="whatIsTitle">🤔 What is Footstep 1?</h2>
            <p class="text-lg text-green-700" data-key="whatIsBody">
                In Footstep 1, we start our amazing journey! We learn about Paul Salopek, a journalist who is walking around the whole world! We introduce ourselves, choose a special avatar, and start talking with other students about this incredible walking adventure!
            </p>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </section>

        <!-- Why is it Important? Card -->
        <section class="adventure-card" style="background-color: #FFFBEB; border-color: #FDE68A;">
            <h2 class="text-3xl font-bold text-amber-800 mb-4" data-key="whyTitle">🎯 Why is Footstep 1 Important?</h2>
            <p class="text-lg text-amber-700" data-key="whyBody">
                Footstep 1 helps us start our learning journey together! We get to know Paul Salopek and his amazing walk around the world. We also get to know each other by sharing about ourselves and choosing avatars. This helps us become walking partners who will learn and explore together!
            </p>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </section>
        
        <!-- Meet Paul Card -->
        <section class="adventure-card" style="background-color: #FEF2F2; border-color: #FECACA;">
            <h2 class="text-3xl font-bold text-red-800 mb-6" data-key="meetPaulTitle">👋 Meet Paul Salopek!</h2>
            <p class="text-lg text-red-700 mb-6" data-key="meetPaulBody">
                Paul is an explorer (like a journalist!) who is on a super long walk around the world, following the path of the first humans. He is walking to listen to stories from all different kinds of people.
            </p>
            <ul class="space-y-4 text-lg md:text-xl">
                <li class="activity-li" style="background-color: #FFFAF0; border: 2px solid #FEEBCB;">
                    <a href="https://www.youtube.com/watch?v=RjhMRhn83IA" target="_blank" class="activity-li-content" rel="noopener noreferrer">
                        <span class="text-2xl">🎧</span>
                        <span class="font-semibold text-orange-700" data-key="paulLink1">Listen to Paul's welcome message from his journey</span>
                    </a>
                </li>
                <li class="activity-li" style="background-color: #F0FAFF; border: 2px solid #D6EEFF;">
                    <a href="https://vimeo.com/175964614" target="_blank" class="activity-li-content" rel="noopener noreferrer">
                        <span class="text-2xl">📺</span>
                        <span class="font-semibold text-sky-700" data-key="paulLink2">Watch a video about why Paul is walking around the world</span>
                    </a>
                </li>
            </ul>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </section>

        <!-- Activities Card -->
        <section class="adventure-card" style="background-color: #FAF5FF; border-color: #E9D5FF;">
            <h2 class="text-3xl font-bold text-purple-800 mb-4" data-key="activitiesTitle">📝 Our Footstep 1 Activities!</h2>
            <p class="text-lg text-purple-700 text-center mb-6" data-key="activitiesSubtitle">Here's what we'll do in Footstep 1:</p>
            <ul class="space-y-4 text-lg md:text-xl" style="list-style: none; padding-left: 0;">
                <li class="activity-li">
                    <div class="activity-li-content">
                        <span class="text-2xl">✏️</span>
                        <span data-key="activity1">Write about yourself and what you enjoy doing</span>
                    </div>
                </li>
                <li class="activity-li">
                    <div class="activity-li-content">
                        <span class="text-2xl">🤖</span>
                        <span data-key="activity2">Let's use AI to create our class avatars</span>
                    </div>
                </li>
                <li class="activity-li">
                    <div class="activity-li-content">
                        <span class="text-2xl">🤝</span>
                        <span data-key="activity3">Read posts from other students and make new friends</span>
                    </div>
                </li>
            </ul>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </section>

        <!-- Your First Mission Card -->
        <section class="adventure-card" style="background-color: #EBF8FF; border-color: #90CDF4;">
            <h2 class="text-3xl font-bold text-sky-800 mb-4" data-key="missionTitle">🚀 Your First Mission!</h2>
            
            <!-- Introduce Yourself -->
            <label for="introduction" class="block text-xl font-semibold text-sky-700 mb-2" data-key="mission1Label">1. Introduce yourself to your walking partners!</label>
            <p class="text-md text-sky-600 mb-4" data-key="mission1Desc">Write a little bit about yourself in the box below. What do you like to do for fun?</p>
            
            <!-- Textarea with Microphone Button -->
            <div class="textarea-container">
                <textarea id="introduction" rows="5" class="w-full p-4 border-2 border-sky-300 rounded-xl text-lg text-gray-800" data-key-placeholder="mission1Placeholder" placeholder="My name is... and I love to play..."></textarea>
                <button id="mic-button" class="stt-button" onclick="startSpeechRecognition()">
                    <!-- Microphone Icon SVG -->
                    <svg class="stt-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V4.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"></path>
                    </svg>
                </button>
            </div>
            <p id="mic-status" class="text-sm text-sky-600 mt-2 h-4"></p> <!-- Status message area -->
            
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </section>

        <!-- Footer -->
        <footer class="adventure-card text-center" style="background-color: #F3E8FF; border-color: #DDD6FE;">
            <p class="text-xl font-bold text-purple-800" data-key="footerText">You're all set for Footstep 1. Great job, explorers!</p>
            <button class="tts-button" onclick="speakCard(this)">
                <!-- Updated Speaker Icon SVG -->
                <svg class="tts-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 9v6h4l5 5V4L9 9H5zm11.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>
                </svg>
            </button>
        </footer>
    </div>

    <script>
        // --- Translations Data ---
        const translations = {
            'en': {
                title: "Footstep 1: Let's Go!",
                subtitle: "Let's start our learning adventure together!",
                whatIsTitle: "🤔 What is Footstep 1?",
                whatIsBody: "In Footstep 1, we start our amazing journey! We learn about Paul Salopek, a journalist who is walking around the whole world! We introduce ourselves, choose a special avatar, and start talking with other students about this incredible walking adventure!",
                whyTitle: "🎯 Why is Footstep 1 Important?",
                whyBody: "Footstep 1 helps us start our learning journey together! We get to know Paul Salopek and his amazing walk around the world. We also get to know each other by sharing about ourselves and choosing avatars. This helps us become walking partners who will learn and explore together!",
                meetPaulTitle: "👋 Meet Paul Salopek!",
                meetPaulBody: "Paul is an explorer (like a journalist!) who is on a super long walk around the world, following the path of the first humans. He is walking to listen to stories from all different kinds of people.",
                paulLink1: "Listen to Paul's welcome message from his journey",
                paulLink2: "Watch a video about why Paul is walking around the world",
                activitiesTitle: "📝 Our Footstep 1 Activities!",
                activitiesSubtitle: "Here's what we'll do in Footstep 1:",
                activity1: "Write about yourself and what you enjoy doing",
                activity2: "Let's use AI to create our class avatars",
                activity3: "Read posts from other students and make new friends",
                missionTitle: "🚀 Your First Mission!",
                mission1Label: "1. Introduce yourself to your walking partners!",
                mission1Desc: "Write a little bit about yourself in the box below. What do you like to do for fun?",
                mission1Placeholder: "My name is... and I love to play...",
                footerText: "You're all set for Footstep 1. Great job, explorers!",
                micListening: "Listening... speak now!",
                micError: "Sorry, I couldn't hear. Please try again."
            },
            'fr': {
                title: "Étape 1 : C'est parti !",
                subtitle: "Commençons notre aventure d'apprentissage ensemble !",
                whatIsTitle: "🤔 C'est quoi l'Étape 1 ?",
                whatIsBody: "À l'Étape 1, nous commençons notre incroyable voyage ! Nous découvrons Paul Salopek, un journaliste qui fait le tour du monde à pied ! Nous nous présentons, choisissons un avatar spécial et commençons à parler avec d'autres étudiants de cette incroyable aventure de marche !",
                whyTitle: "🎯 Pourquoi l'Étape 1 est-elle importante ?",
                whyBody: "L'Étape 1 nous aide à commencer notre parcours d'apprentissage ensemble ! Nous apprenons à connaître Paul Salopek et son incroyable marche autour du monde. Nous apprenons aussi à nous connaître en partageant des informations sur nous-mêmes et en choisissant des avatars. Cela nous aide à devenir des partenaires de marche qui apprendront et exploreront ensemble !",
                meetPaulTitle: "👋 Rencontrez Paul Salopek !",
                meetPaulBody: "Paul est un explorateur (comme un journaliste !) qui effectue une très longue marche autour du monde, en suivant le chemin des premiers humains. Il marche pour écouter les histoires de toutes sortes de gens.",
                paulLink1: "Écoutez le message de bienvenue de Paul depuis son voyage",
                paulLink2: "Regardez une vidéo sur pourquoi Paul fait le tour du monde à pied",
                activitiesTitle: "📝 Nos activités de l'Étape 1 !",
                activitiesSubtitle: "Voici ce que nous ferons à l'Étape 1 :",
                activity1: "Écrire sur vous-même et ce que vous aimez faire",
                activity2: "Utilisons l'IA pour créer nos avatars de classe",
                activity3: "Lire les messages des autres étudiants et se faire de nouveaux amis",
                missionTitle: "🚀 Votre première mission !",
                mission1Label: "1. Présentez-vous à vos partenaires de marche !",
                mission1Desc: "Écrivez un peu sur vous dans la case ci-dessous. Qu'aimez-vous faire pour vous amuser ?",
                mission1Placeholder: "Je m'appelle... et j'adore jouer...",
                footerText: "Vous êtes prêts pour l'Étape 1. Bravo, les explorateurs !",
                micListening: "J'écoute... parlez maintenant !",
                micError: "Désolé, je n'ai pas pu entendre. Veuillez réessayer."
            },
            'ja': {
                title: "ステップ1：さあ、行こう！",
                subtitle: "一緒に学びの冒険を始めましょう！",
                whatIsTitle: "🤔 ステップ1ってなに？",
                whatIsBody: "ステップ1では、私たちの素晴らしい旅が始まります！世界中を歩いているジャーナリスト、ポール・サロペックさんについて学びます。自己紹介をしたり、特別なアバターを選んだり、この信じられないような冒険について他の生徒と話し始めたりします！",
                whyTitle: "🎯 なぜステップ1は重要なの？",
                whyBody: "ステップ1は、私たちが一緒に学ぶ旅を始めるのに役立ちます！ポール・サロペックさんと、彼の素晴らしい世界一周の徒歩旅行について知ることができます。また、自分自身について共有したり、アバターを選んだりすることでお互いを知ることができます。これにより、私たちは一緒に学び、探検する「ウォー킹・パートナー」になるのです！",
                meetPaulTitle: "👋 ポール・サロペックさんを紹介します！",
                meetPaulBody: "ポールさんは探検家（ジャーナリストのようなものです！）で、最初の人類の道をたどって世界中をとても長く歩いています。彼はさまざまな種類の人々から話を聞くために歩いています。",
                paulLink1: "ポールさんの旅からのウェルカムメッセージを聞く",
                paulLink2: "ポールさんがなぜ世界中を歩いているのか、ビデオを見る",
                activitiesTitle: "📝 ステップ1の活動！",
                activitiesSubtitle: "ステップ1で私たちがすること：",
                activity1: "自分自身と楽しんでいることについて書く",
                activity2: "AIを使ってクラスのアバターを作ろう",
                activity3: "他の生徒の投稿を読んで、新しい友達を作る",
                missionTitle: "🚀 最初のミッション！",
                mission1Label: "1. ウォーキング・パートナーに自己紹介しよう！",
                mission1Desc: "下のボックスに自分自身について少し書いてみましょう。何をして楽しんでいますか？",
                mission1Placeholder: "私の名前は...です。趣味は...です。",
                footerText: "ステップ1の準備ができました。よくできました、探検家のみなさん！",
                micListening: "聞いています...どうぞ！",
                micError: "すみません、聞こえませんでした。もう一度お試しください。"
            },
            'ko': {
                title: "첫 번째 발걸음: 출발!",
                subtitle: "우리의 학습 모험을 함께 시작해요!",
                whatIsTitle: "🤔 첫 번째 발걸음이 뭔가요?",
                whatIsBody: "첫 번째 발걸음에서, 우리는 놀라운 여정을 시작합니다! 전 세계를 걷고 있는 저널리스트, 폴 살로펙에 대해 배워요! 우리를 소개하고, 특별한 아바타를 고르고, 이 멋진 걷기 모험에 대해 다른 학생들과 이야기하기 시작할 거예요!",
                whyTitle: "🎯 왜 첫 번째 발걸음이 중요할까요?",
                whyBody: "첫 번째 발걸음은 우리가 함께 배우는 여정을 시작하도록 도와줘요! 폴 살로펙과 그가 전 세계를 걷는 놀라운 여정에 대해 알게 되죠. 또 우리 자신에 대해 이야기하고 아바타를 고르면서 서로를 알아가게 돼요. 이렇게 해서 우리는 함께 배우고 탐험하는 '걷기 파트너'가 될 수 있어요!",
                meetPaulTitle: "👋 폴 살로펙을 만나보세요!",
                meetPaulBody: "폴은 최초의 인류가 걸었던 길을 따라 아주 오랫동안 전 세계를 걷고 있는 탐험가(저널리스트 같은!)예요. 그는 다양한 사람들의 이야기를 듣기 위해 걷고 있답니다.",
                paulLink1: "폴이 여정 중에 보낸 환영 메시지 듣기",
                paulLink2: "폴이 왜 전 세계를 걷고 있는지 비디오 보기",
                activitiesTitle: "📝 우리의 첫 번째 발걸음 활동!",
                activitiesSubtitle: "첫 번째 발걸음에서 우리가 할 일들이에요:",
                activity1: "여러분이 즐겨 하는 일과 자신에 대해 글쓰기",
                activity2: "인공지B지능으로 우리 반 아바타 만들기",
                activity3: "다른 학생들이 쓴 글을 읽고 새 친구 사귀기",
                missionTitle: "🚀 여러분의 첫 번째 미션!",
                mission1Label: "1. '걷기 파트너'들에게 여러분을 소개하세요!",
                mission1Desc: "아래 상자에 여러분에 대해 조금 써보세요. 재미로 무엇을 하는 것을 좋아하나요?",
                mission1Placeholder: "제 이름은... 이고, 저는 ...하는 것을 좋아해요.",
                footerText: "첫 번째 발걸음을 위한 준비가 끝났어요. 잘했어요, 탐험가들!",
                micListening: "듣고 있어요... 말씀하세요!",
                micError: "죄송해요, 듣지 못했어요. 다시 시도해 주세요."
            }
        };
        
        // --- Language Switcher Function ---
        let currentLang = 'en';
        
        function changeLanguage(lang) {
            currentLang = lang;
            // Stop any playing speech (ONLY IF AVAILABLE)
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
            
            // Translate all elements with data-key
            document.querySelectorAll('[data-key]').forEach(elem => {
                const key = elem.getAttribute('data-key');
                if (translations[lang] && translations[lang][key]) {
                    elem.textContent = translations[lang][key];
                }
            });
            
            // Translate all elements with data-key-placeholder
            document.querySelectorAll('[data-key-placeholder]').forEach(elem => {
                const key = elem.getAttribute('data-key-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    elem.placeholder = translations[lang][key];
                }
            });

            // Translate mic status message if it's not empty
            const micStatus = document.getElementById('mic-status');
            const currentStatusKey = micStatus.dataset.key;
            if (currentStatusKey && translations[lang][currentStatusKey]) {
                micStatus.textContent = translations[lang][currentStatusKey];
            }
            
            // Set HTML lang attribute for accessibility
            document.documentElement.lang = lang;
        }

        // --- Text-to-Speech (TTS) Function ---
        function speakCard(button) {
            // Check if TTS is available at all
            if (!window.speechSynthesis) {
                console.warn("Speech Synthesis is not supported or blocked in this environment.");
                if (button) button.style.display = 'none'; 
                return;
            }

            // Find the parent adventure-card
            const card = button.closest('.adventure-card');
            if (!card) return;

            // Gather all text elements to be read
            const textToSpeak = [];
            card.querySelectorAll('h1, h2, h3, p, label, span, li').forEach(elem => {
                if (!elem.closest('a') && !elem.closest('button') && !elem.closest('select')) {
                     const text = elem.textContent || elem.innerText;
                     if(text) textToSpeak.push(text.trim());
                }
            });
            
            const fullText = textToSpeak.join('. ');

            if (fullText) {
                // Stop any previous speech
                window.speechSynthesis.cancel();
                // Regex to remove most emojis and symbols
                const emojiRegex = /[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F900}-\u{1F9FF}]/gu;
                const cleanText = fullText.replace(emojiRegex, '');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = currentLang;
                const voices = window.speechSynthesis.getVoices();
                let selectedVoice = voices.find(voice => voice.lang === currentLang);
                
                if (!selectedVoice) {
                    selectedVoice = voices.find(voice => voice.lang.startsWith(currentLang));
                }

                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                window.speechSynthesis.speak(utterance);
            }
        }

        // Ensure voices are loaded for the TTS function (ONLY IF AVAILABLE)
        if (window.speechSynthesis) {
            window.speechSynthesis.onvoiceschanged = () => {
                // console.log("Voices loaded"); // No need to log this repeatedly
            };
        }

        // --- Speech-to-Text (STT) Function ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            const micButton = document.getElementById('mic-button');
            const introductionBox = document.getElementById('introduction');
            const micStatus = document.getElementById('mic-status');

            recognition.continuous = false; // Stop after one phrase
            recognition.interimResults = false; // Get final results only
            
            recognition.onstart = () => {
                micButton.classList.add('is-listening');
                micStatus.textContent = translations[currentLang].micListening;
                micStatus.dataset.key = 'micListening'; // Store key for re-translation
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                // Append the new text
                introductionBox.value += (introductionBox.value.length > 0 ? ' ' : '') + transcript + '.';
            };

            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
                micStatus.textContent = translations[currentLang].micError;
                micStatus.dataset.key = 'micError'; // Store key for re-translation
            };

            recognition.onend = () => {
                micButton.classList.remove('is-listening');
                // Clear status after a moment
                setTimeout(() => {
                    micStatus.textContent = '';
                    micStatus.dataset.key = '';
                }, 2000);
            };

            window.startSpeechRecognition = () => {
                // Set the language for recognition based on the current page lang
                recognition.lang = currentLang;
                try {
                    recognition.start();
                } catch(e) {
                    console.error("Error starting speech recognition:", e);
                    micStatus.textContent = translations[currentLang].micError;
                    micStatus.dataset.key = 'micError';
                }
            };

        } else {
            // If STT is not supported, hide the mic button
            console.warn("Speech Recognition is not supported in this browser.");
            const micButton = document.getElementById('mic-button');
            if (micButton) micButton.style.display = 'none';
        }

        // Initial language set on load
        changeLanguage(currentLang);

    </script>
</body>
</html>

